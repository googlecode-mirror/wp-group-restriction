#summary Instalation instructions
==Instalation==


===Simple Instalation===

After downloading this plugin, extract the directory "wp-group-restriction".

Go to the wordpress back-office and activate the plugin. This will create the needed tables in the database.

===Advanced Instalation===

In order to filter out the pages the current user can no edit from the pages list (Manage Pages), replace the line:

*wordpress\wp-admin\edit-pages.php Line 28*
{{{                                                                                          
  $posts = $wpdb->get_results("SELECT * FROM $wpdb->posts WHERE post_status = 'static'");
}}}                                                                                         

by 
*wordpress\wp-admin\edit-pages.php Line 28*

{{{
  /*plugin tables*/
  $table_groupsPage = $table_prefix . "ug_GroupsPage";
  $table_groups = $table_prefix . "ug_Groups";
  $table_groupsUsers = $table_prefix . "ug_GroupsUsers";
  
  $query = "SELECT * FROM $table_groupsUsers tgu
              WHERE tgu.id_user='$user_ID';";
              
  $results = $wpdb->get_results( $query );
  
  $stringGrupos;
  $cont = 0;
  if(isset($results))
  foreach ($results as $res){
    if($cont > 0){
      $stringGrupos .= " OR ";
    }
    $stringGrupos .= "gp.id_group='$res->id_group' ";
    $cont ++;
  }
  if($cont > 0){
    $stringGrupos ="SELECT p.* from ".$wpdb->posts." p, $table_groupsPage gp
              WHERE p.ID=gp.id_page and ( $stringGrupos )
              UNION
              ";
    
  }
  //if the user is not an administrator or if the table does not exist
  if($user_level < 8 && $wpdb->get_var("show tables like '$table_groupsPage'") != $table_groupsPage){ 
    
    $query = "$stringGrupos
              SELECT * from wp_posts
              WHERE post_status='static' and (ID NOT IN (
              	SELECT DISTINCT p.id from ".$wpdb->posts." p
              	INNER JOIN ($table_groupsPage gp )
              	ON (gp.id_page = p.ID and gp.exc_write='1')
              ) or post_author=$user_ID) ORDER BY post_title;";
  }else{
    //default query
    $query ="SELECT * FROM $wpdb->posts WHERE post_status = 'static'";
  
  }
  //$query ="SELECT * FROM $wpdb->posts WHERE post_status = 'static'";
  $posts = $wpdb->get_results($query);

}}}

To filter out access from the front office, update your theme to call: 
{{{  
  if(class_exists("userGroups")){
    $groups = new userGroups();
    $pagesToExclude = userGroups::getPagesToExclude();
  }
}}}
and add the returning value to 
{{{
wp_list_pages("exclude=" . $pagesToExclude . "&sort_column=menu_order&depth=1&title_li=");
}}}
This allows to hide pages the user has no reading access.

==Configuration==

===Group Management===

    * Groups
    * Pages Access
    * Access per Page
    * Members


Access "Groups" from the main menu in order to manage the groups:
* "Groups > Groups" - to manage Existing Groups
* "Groups > Pages Access" - to add and remove pages from groups
* "Groups > Access per Page" - to add and remove groups from pages
* "Groups > Members" - to add and remove users from groups

Note: Free Access Pages are pages without a group.

===User Management===
Access "Users > Authors & Users" and edit a user to add or remove users from a group.

===Page Edit===

While editing or creating a page, the user can choose the groups with access to the page, by checking/unchecking the groups after the page edit panel.

Keep in mind that both the administrators and the author can edit the page.

